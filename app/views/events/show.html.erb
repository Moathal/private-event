<h1>The Event</h1>
<h3><%= @event.location %></h3>
<h3><%= @event.date %></h3>
<h3><%= @event.creator.fullname %></h3>

<% if !current_user.nil? && current_user.id != @event.creator_id %>
  <% if current_user.attended_events.include?(@event) %>
    <%= button_to "Cancel Attendance", attend_event_path(@event), method: :delete, remote: true %>
  <% else %>
    <%= button_to "Attend", attend_event_path(@event), method: :post, remote: true %>
  <% end %>
<% elsif current_user && current_user.id == @event.creator.id %>
  <%= button_to "Cancel the event", @event, method: :delete, data: { confirm: "Are you sure you want to cancel this event?!" }, remote: true %>
  <%= link_to 'Edit event', edit_event_path(@event.id) %>
  <% if @users.present? %>
    <%= form_with(url: invite_event_path) do |form| %>
      <% @users.each do |user| %>
         <label>
          <%= form.check_box :user_ids, { multiple: true }, user.id, nil %>
          <%= user.fullname %>
        </label>
      <% end %>
      <%= form.hidden_field :event_id, value: @event.id %>
      <%= form.submit "Invite" %>
    <% end %>
  <% else %>
    <h5>No Users!!</h5>
  <% end %>
<% end %>

<h2>Attendances</h2>
<ul>
<li><%= @event.creator.fullname %></li>
  <% if @event.attendances.any? %>
    <% @event.attendances.each do |attendance| %>
      <% if attendance.status != "canceled" && attendance.status != "rejected" %>
        <li>
          <%= attendance.user.fullname %>
          <% if attendance.invited_user == true %>
            <br>
            <%= attendance.status %>
            <%= button_to "Cancel Invitation", cancel_invitation_event_path(@event.id), method: :post, params: { attendance_id: attendance.id }, data: { user_id: attendance.user.id } %>
         <% end %>
       </li>
            <br>
      <% end %>
    <% end %>
  <% end %>
</ul>

<div style="display: flex; flex-direction: row; gap: 1rem;">
  <%= link_to 'All events', events_path %>
  <%= link_to 'All users', users_path %>
</div>